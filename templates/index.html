{% extends "layout.html" %}
{% block title %}Welcome{% endblock title %}

{% block content %}

<div class="flash-container position-absolute top-0 start-50 translate-middle-x p-3" style="z-index: 1050;">
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
      {% for category, message in messages %}
      <div class="alert alert-{{ category }} fade show shadow" role="alert" style="opacity: 1; transition: opacity 0.5s;">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %}
  {% endif %}
  {% endwith %}
</div>


<div class="container vh-100 mb-5">
  <div class="container-fluid" id="hiddenContent" style="display: none; height: 65%;">
    <!-- Add your hidden content here -->
  </div>
  <div class="container-fluid" id="content" style="margin-top: 170px; padding-right: 150px;">
    <h1 class="display-4 text-center mb-4"  id="header" style="font-weight: 500; font-size: 30px;">What can I help with?</h1>
    <div class="container pt-2" style="min-height: 110px; width: 90%; border-style: none;
                  border-radius: 25px; background-color: rgb(240, 242, 242);">
      <form>
        <div class="mb-1">
          <textarea class="form-control" id="exampleFormControlTextarea1" rows="1"
            style="background-color: rgb(240, 242, 242); border-style: none;" placeholder="Message" required></textarea>
        </div>
        <div class="d-flex flex-row-reverse">
          <button type="submit" class="btn btn-secondary" id="askButton">Ask</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    console.log("Document loaded");

    const contentDiv = document.getElementById('hiddenContent');
    const chatDiv = document.getElementById('content');
    const header = document.getElementById('header');
    const askButton = document.getElementById('askButton');
    const textarea = document.getElementById('exampleFormControlTextarea1');
    //localStorage.setItem('contentVisible', 'false');
    //localStorage.setItem('message', "");

    // Check localStorage to persist the visibility state
    if (localStorage.getItem('contentVisible') === 'true') {
      contentDiv.style.display = 'block'; 
      const storedMessage = localStorage.getItem('message');
      if (storedMessage) {
        contentDiv.innerText = storedMessage;
      }
      header.style.display = 'none';
      chatDiv.style.marginTop = '10px'; 
    }

    // Add click event listener to the button
    askButton.addEventListener('click', function (event) {
      const message = textarea.value.trim();
      if (!message) {
        textarea.focus();
        return;
      }
      event.preventDefault(); 
      console.log("Button clicked");
      textarea.value = "";
      contentDiv.innerText = message;
      contentDiv.style.display = 'block'; 
      header.style.display = 'none';
      chatDiv.style.marginTop = '10px';
      localStorage.setItem('contentVisible', 'true'); 
      localStorage.setItem('message', message);
    });
  });
</script>
{% endblock content %}
